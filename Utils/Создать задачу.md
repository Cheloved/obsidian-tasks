---
Проект: "[[Проекты/Настройка связи.md|Настройка связи]]"
Название: Тестовое задание
Участники:
  - "[[Участники/Старлей.md|Старлей]]"
Начало: 2025-02-22
Дедлайн: 2025-04-27
Статус: Сделать
Приоритет: 1
Тестовое: 1
---

```dataviewjs


let proj_options = dv.pages('"Проекты"')
				   .where(p => p['filetype'] == "project")
				   .map(p => "option(" + p.file.link + ")")
				   .join(", ");
				   
const project  = `\`INPUT[inlineSelect(${proj_options}):Проект]\``;

dv.header(3, "Создание задачи:");
dv.paragraph("Проект: "     + project);
```
Название: `INPUT[text(placeholder('Название')):Название]`
```dataviewjs

let role_options = dv.pages('"Участники"')
				   .map(p => "option(" + String(p.file.link) + ")")
				   .join(", ");

const assigned = `\`INPUT[inlineListSuggester(`+role_options+`):Участники]\``;
dv.paragraph("Участники: "  + assigned);
```
Начало: `INPUT[date:Начало]`

Дедлайн: `INPUT[date:Дедлайн]`

Статус: `INPUT[inlineSelect(option(Сделать), option(Активна), option(Завершена)):Статус]`

Приоритет:
```meta-bind
INPUT[progressBar(maxValue(5), minValue(0)):Приоритет]
```
```dataviewjs
const filename = dv.current()["Название"]
const type     = filename + "#filetype"
const project  = filename + "#Проект"
const name     = filename + "#Название"
const assigned = filename + "#Участники"
const start    = filename + "#Начало"
const due      = filename + "#Дедлайн"
const status   = filename + "#Статус"
const priority = filename + "#Приоритет"

let name_exist = dv.pages('"Задачи"')
				   .where(p => p['filetype'] == "task")
				   .map(p => p['Название'])
				   .includes(dv.current()['Название']);

let label = "Создать!";
let style = "primary";
let button  = `\`\`\`meta-bind-button 
label: ${label}
style: ${style}
id: "create-task-btn"
hidden: false
actions:
  - type: sleep
    ms: 500
  - type: createNote
    folderPath: "Задачи"
    fileName: ${filename}
    openNote: true
  - type: updateMetadata
    bindTarget: ${type}
    evaluate: false
    value: "task"
  - type: updateMetadata
    bindTarget: ${project}
    evaluate: true
    value: "getMetadata('Проект')"
  - type: updateMetadata
    bindTarget: ${name}
    evaluate: true
    value: "getMetadata('Название')"
  - type: updateMetadata
    bindTarget: ${assigned}
    evaluate: true
    value: "getMetadata('Участники')"
  - type: updateMetadata
    bindTarget: ${start}
    evaluate: true
    value: "getMetadata('Начало')"
  - type: updateMetadata
    bindTarget: ${due}
    evaluate: true
    value: "getMetadata('Дедлайн')"
  - type: updateMetadata
    bindTarget: ${status}
    evaluate: true
    value: "getMetadata('Статус')"
  - type: updateMetadata
    bindTarget: ${priority}
    evaluate: true
    value: "getMetadata('Приоритет')"
\`\`\``;

if ( name_exist ) {
	label = "Название задачи \"" + filename + "\" уже используется!";
	style = "destructive";
	button  = `\`\`\`meta-bind-button 
label: ${label}
style: ${style}
id: "create-task-btn"
hidden: false
actions:
  - type: sleep
    ms: 500
\`\`\``;

}

dv.paragraph(button);
```
